<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title></title>
  </head>

  <body>
    <script src="scripts/lib/jquery.js" type="text/javascript"></script>
    <script type="text/javascript">
      var host = 'https://login.zooniverse.org/';
      if (!!~location.host.indexOf('localhost')) host = 'http://localhost:3000';

      function postBack(command, response) {
        parent.postMessage({command: command, response: response}, location.protocol + '//' + location.host);
      }

      $(window).on('message', function(e) {
        var commands = e.originalEvent.data;

        for (var command in commands) {
          var url = host + '/' + command
          var params = commands[command] || {};

          console.log('Getting', url, params);

          $.getJSON(url + '?callback=?', params, function(response) {
            postBack(command, response);
          });
        }
      });

      // Check for current user.
      $.getJSON(host + '/current_user?callback=?', function(response) {
        if (response.success === true) postBack('login', response);
      })
    </script>
  </body>
</html>
